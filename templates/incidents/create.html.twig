{% extends "base.html.twig" %}

{% block title %}Create Incident - Cybersecurity Incident Management{% endblock %}

{% block content %}
<div class="page-header">
    <h2>Create New Incident</h2>
    <a href="incidents.php" class="btn btn-secondary">Back to Incidents</a>
</div>

{% if errors is not empty %}
    <div class="alert alert-error">
        <ul>
            {% for error in errors %}
                <li>{{ error|escape }}</li>
            {% endfor %}
        </ul>
    </div>
{% endif %}

<form method="POST" action="" class="form">
    <input type="hidden" name="csrf_token" value="{{ csrf_token() }}">
    
    <div class="form-group">
        <label for="incident_type">Incident Type *</label>
        <input type="text" id="incident_type" name="incident_type" required 
               value="{{ form_data.incident_type|default('')|escape }}"
               placeholder="e.g., Phishing, Malware, Data Breach">
    </div>

    <div class="form-group">
        <label for="date_time">Date & Time *</label>
        <input type="datetime-local" id="date_time" name="date_time" required 
               value="{{ form_data.date_time|default('')|escape }}">
    </div>

    <div class="form-group">
        <label for="affected_system_id">Affected System *</label>
        <select id="affected_system_id" name="affected_system_id" required>
            <option value="">Select a system</option>
            {% for system in systems %}
                <option value="{{ system.id }}" 
                        {% if form_data.affected_system_id|default(0) == system.id %}selected{% endif %}>
                    {{ system.name|escape }} ({{ system.type|escape }})
                </option>
            {% endfor %}
        </select>
    </div>

    <div class="form-group">
        <label for="severity">Severity *</label>
        <select id="severity" name="severity" required>
            <option value="">Select severity</option>
            <option value="Low" {% if form_data.severity|default('') == 'Low' %}selected{% endif %}>Low</option>
            <option value="Medium" {% if form_data.severity|default('') == 'Medium' %}selected{% endif %}>Medium</option>
            <option value="High" {% if form_data.severity|default('') == 'High' %}selected{% endif %}>High</option>
            <option value="Critical" {% if form_data.severity|default('') == 'Critical' %}selected{% endif %}>Critical</option>
        </select>
    </div>

    <div class="form-group">
        <label for="resolution_notes">Resolution Notes</label>
        <textarea id="resolution_notes" name="resolution_notes" rows="5" 
                  placeholder="Enter resolution notes or initial observations...">{{ form_data.resolution_notes|default('')|escape }}</textarea>
    </div>

    <div class="form-actions">
        <button type="submit" class="btn btn-primary">Create Incident</button>
        <a href="incidents.php" class="btn btn-secondary">Cancel</a>
    </div>
</form>
{% endblock %}

